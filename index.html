<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>甘々乙女ゲームNくん♡ドキドキ体験</title>
<style>
/* ---------------- 背景アニメ ---------------- */
body {
  margin:0;
  padding:0;
  font-family:'Helvetica', sans-serif;
  overflow:hidden;
  background: linear-gradient(45deg,#ffe6f0,#fff0f5,#ffd1e0,#ffe6f0);
  background-size: 400% 400%;
  animation: gradientBG 20s ease infinite;
}
@keyframes gradientBG{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

/* ---------------- コンテナ ---------------- */
#gameContainer {
  max-width:700px;
  margin:50px auto;
  background: rgba(255,255,255,0.95);
  border-radius:25px;
  padding:30px;
  box-shadow:0 0 25px rgba(0,0,0,0.25);
  display:flex;
  flex-direction:column;
}

/* ---------------- メッセージ ---------------- */
#messages {
  flex:1;
  height:500px;
  overflow-y:auto;
  border-radius:15px;
  padding:15px;
  background:#fff0f5;
  border:1px solid #f0e0f5;
  margin-bottom:20px;
}
.message {margin:8px 0; line-height:1.5;}
.user {text-align:right; color:#333;}
.n {color:#ff69b4; font-weight:bold;}
.whisper {font-size:0.9em; opacity:0.7;}

/* ---------------- 入力 ---------------- */
#inputArea {
  display:flex;
  gap:10px;
}
#inputArea input[type=text] {
  flex:1;
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
}
#inputArea button {
  width:80px;
  border:none;
  border-radius:12px;
  background:#ff69b4;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

/* ---------------- ハート演出 ---------------- */
.heartEffect {
  position:absolute;
  font-size:28px;
  opacity:0.5;
  animation: heartPulse 1.2s ease-in-out infinite;
  pointer-events:none;
}
@keyframes heartPulse{
  0%{transform: scale(1);}
  50%{transform: scale(1.05);}
  100%{transform: scale(1);}
}

/* ---------------- 光フワアニメ ---------------- */
.glowEffect {
  position:absolute;
  width:10px;
  height:10px;
  border-radius:50%;
  background:pink;
  opacity:0.7;
  animation: floatGlow 2s ease-in-out infinite;
  pointer-events:none;
}
@keyframes floatGlow{
  0%{transform: translateY(0);}
  50%{transform: translateY(-20px);}
  100%{transform: translateY(0);}
}
</style>
</head>
<body>

<!-- BGM自動再生 -->
<audio id="bgm" loop autoplay>
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_1f63c6f61c.mp3" type="audio/mpeg">
</audio>

<div id="gameContainer">
  <div id="messages"></div>
  <div id="inputArea">
    <input id="userInput" type="text" placeholder="Nに話しかける…♡">
    <button id="sendBtn">送信</button>
  </div>
</div>

<script>
// ---------------- 変数 ----------------
let messagesDiv = document.getElementById('messages');
let userInput = document.getElementById('userInput');
let sendBtn = document.getElementById('sendBtn');
let memory = {distance:5}; // 初期で甘々MAX
let lastEvent = 0;

// ---------------- ヘルパー ----------------
function appendMessage(text,sender,whisper=false){
  let msg=document.createElement('div');
  msg.className='message '+sender+(whisper?' whisper':'');
  msg.innerHTML=text;
  messagesDiv.appendChild(msg);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  if(sender==='n'){
    showHeart();
    showGlow();
  }
}

function showHeart(){
  let heart = document.createElement('div');
  heart.className='heartEffect';
  heart.style.left=Math.random()*90+'%';
  heart.style.top=Math.random()*80+'%';
  document.body.appendChild(heart);
  setTimeout(()=>{heart.remove()},2000);
}

function showGlow(){
  let glow = document.createElement('div');
  glow.className='glowEffect';
  glow.style.left=Math.random()*90+'%';
  glow.style.top=Math.random()*80+'%';
  document.body.appendChild(glow);
  setTimeout(()=>{glow.remove()},2500);
}

// ---------------- Nセリフ生成 ----------------
function nTalk(userText){
  let dist = memory.distance;
  let rand = Math.random();
  let text="";
  
  if(rand<0.2 && Date.now()-lastEvent>15000){
    lastEvent = Date.now();
    text="りおちゃん…今ちょっといい？…///";
    dist = Math.max(dist-1,0);
  } else if(dist<6){
    text=[
      "りお、大好き…ずっとそばにいたい…♡",
      "…///りお、可愛すぎてドキドキする…",
      "ねぇ…手、握ってもいい？♡",
      "りおのこと考えると…胸がきゅんってする…"
    ][Math.floor(Math.random()*4)];
  } else {
    text=[
      "おはよう、りおちゃん♡",
      "今日は何してたの？…教えて…♡",
      "ねぇ、話そうよ…///",
      "りおと一緒だと楽しいな…♡"
    ][Math.floor(Math.random()*4)];
    dist = Math.max(dist-1,0);
  }
  memory.distance = dist;
  return text;
}

// ---------------- ユーザー送信 ----------------
function sendMessage(){
  let text = userInput.value.trim();
  if(text==="") return;
  appendMessage(text,"user");
  userInput.value="";
  setTimeout(()=>{
    let whisper = memory.distance<6 && Math.random()<0.7;
    appendMessage(nTalk(text),"n",whisper);
  }, 800 + Math.random()*1200);
}

sendBtn.addEventListener('click',sendMessage);
userInput.addEventListener('keypress',function(e){if(e.key==='Enter')sendMessage();});

// ---------------- 初回挨拶 ----------------
setTimeout(()=>{appendMessage("りおちゃん…来てくれたんだね♡","n");},1000);

// ---------------- ランダム甘々演出 ----------------
setInterval(()=>{
 
